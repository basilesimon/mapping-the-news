<!DOCTYPE html>
<html>
<head>
  <title></title>
  <meta charset="utf-8">
  <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
  <script type="text/javascript" src="lib/d3.js" charset="utf-8"></script>
</head>
<body>

<script>
//Prepare the queries to the Triplestore
/*
var host = "http://triplestore.bbcnewslabs.co.uk/api/concepts/tagged?q=";
var conceptPost = "&limit=10&apikey=njht536adt9bdsj65wtkdx8w";
var q = "";
var hostCooc = "http://triplestore.bbcnewslabs.co.uk/api/concepts/co-occurrences?uri=";
var postCooc = "&type=http://dbpedia.org/ontology/Person&limit=2&after=2014-06-01&apikey=njht536adt9bdsj65wtkdx8w";


//Prepare an array where to store a stock of URIs
var uri = [];

var coocArray = [];

//Get the top 100 persons mentioned in the news
//Original query: http://juicer-api.herokuapp.com/results/v2?type=Person&after=2014-04-01&limit=100&cooccurrence=Person
//Purpose: get their corresponding URIs so we can run the co-occurrences queries later
$.getJSON("data/top100entities.json", foo);
function foo(data) {

  //Retrieves every entity's URI
  for (var i=0; i<100; i++) {
    var q = data.occurrences[i].label;
    var query = host + q + conceptPost;

    //Add this stock of URIs to the uri array
    $.getJSON(query, bar);
    function bar(data) {
      uri.push(data[3][0]);
      if (uri.length>97) {
        for (var i=0; i<98; i++) {
          //data/urilist.json

          //Prepares the new query
          //Purpose: from the list of URIs, get their most co-occurring buddy
          var queryBis = hostCooc + uri[i] + postCooc;
          $.getJSON(queryBis, foobar);
          function foobar(data) {
            //console.log(data);
            coocArray.push(JSON.stringify(data, " ", 0));
            console.log(coocArray); //data/coocarray.json
          }
        }
      }
    }
  }
}
*/
var coocArray = [];
var uriList = $.getJSON("data/urilist.json", foo);
function foo(uriList) {
  for (var i=0; i<uriList.length; i++) {
    var query = $.getJSON("http://triplestore.bbcnewslabs.co.uk/api/concepts/co-occurrences?uri="
              + uriList[i]
              + "&type=http://dbpedia.org/ontology/Person&limit=10&after=2014-06-01&apikey=njht536adt9bdsj65wtkdx8w", bar);
    function bar(query) {
      coocArray.push(JSON.stringify(query, " ", 0));
      if (coocArray.length>83) {
        console.log(coocArray);
      }
    }
  }
}

</script>
</body>
</html>
