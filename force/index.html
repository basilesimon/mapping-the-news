<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mapping the News</title>
  <script type="text/javascript" src="d3.js"></script>
  <script type="text/javascript" src="d3.geom.js"></script>
  <script type="text/javascript" src="d3.layout.js"></script>
</head>

<body>

</body>

<style>
  body{
    background=color: #fafafa;
    font=size: 16px;
  }
  circle.node {
    cursor: pointer;
    stroke: #000;
    stroke-width:px;
  }
  line.link {
    fill: none;
    stroke: #9ecae1;
    stroke-width: 1.5px;
  }
</style>
<script>

var w = 1280,
    h = 800;
var svg = d3.select("body")
  .append("svg")
  .attr("width", w)
  .attr("height", h)
  .attr("preserveAspectRatio", "xMinYMin slice")
  .append("g");

d3.json("test.json", function(error,json) {
  if(error) {return console.warn(error)};

 /*Maps through data.json to get co-occurrences*/
  var mapCooc = json.occurrences.map(function(d){return d.cooccurrences;})
  console.log("TESTS");
  console.log(json);
  console.log(json.occurrences);
  console.log(mapCooc)

  var force = self.force = d3.layout.force()
    .nodes(json.occurrences)
    .links(json.links)
    .linkStrength(0.5)
    .linkDistance(10)
    .gravity(0.3)
    .distance(20)
    .charge(-700)
    .size([w,h])
    .start();

  var node_drag = d3.behavior.drag()
    .on("dragstart", dragstart)
    .on("drag", dragmove)
    .on("dragend", dragend);

  var node = svg.selectAll("circle")
    .data(json.occurrences)
    .enter().append("circle")
    .attr("class", "node")
    .attr("r", function(d){return d.occurrence/70})
    .attr("cx", function() {
      return Math.random() * w;
    })
    .attr("cy", function() {
      return Math.random() * h;
    })
    .style("fill", "#ef492a")
    .call(force.drag);

  var link = svg.selectAll(".link")
    .data(json.links)
    .enter().append("line")
    .attr("class", "link")
/*    .attr("x1", function(d) { return d.source.x; })
    .attr("y1", function(d) { return d.source.y; })
    .attr("x2", function(d) { return d.target.x; })
    .attr("y2", function(d) { return d.target.y; });*/

  function dragstart(d, i) {
    force.stop(); // stops the force auto positioning before you start dragging
  }

  function dragmove(d, i) {
    d.px += d3.event.dx;
    d.py += d3.event.dy;
    d.x += d3.event.dx;
    d.y += d3.event.dy;
    tick();
  }

  function dragend(d, i) {
    d.fixed = true; // of course set the node to fixed so the force doesn't include the node in its auto positioning stuff
    tick();
    force.resume();
  }
    node.append("title")
      .text(function(d) {
        var tool = d.label ;
        return (tool);
      });
  force.on("tick", tick);

/*Needs fixing the appropriate position post drag*/
  function tick() {
    link.attr("x1", function(d) { return d.source.x; })
        .attr("y1", function(d) { return d.source.y; })
        .attr("x2", function(d) { return d.target.x; })
        .attr("y2", function(d) { return d.target.y; });
    node.attr("cx", function(d) { return d.x; })
        .attr("cy", function(d) { return d.y; });
  }
});
</script>

</html>
